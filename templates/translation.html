<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì‹¤ì‹œê°„ ë²ˆì—­ - ì„¸ì…˜ ë·° (ë³„ë„ íŒì—… ì°½)</title>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<style>
    /* â­ï¸ CSS ë³€ìˆ˜ ì„ ì–¸: í°íŠ¸ í¬ê¸°, í°íŠ¸ ì¢…ë¥˜ (JSì—ì„œ ë™ì ìœ¼ë¡œ ë³€ê²½) */
    :root {
        /* â­ï¸ [ìˆ˜ì •] ê¸°ë³¸ í°íŠ¸ ì¢…ë¥˜ëŠ” í•˜ë“œì½”ë”© */
        --log-font-size: 14px;
        --log-font-family: 'Segoe UI', Arial, sans-serif;
        /* ë‹¤í¬ ëª¨ë“œ (ê¸°ë³¸ê°’) ë³€ìˆ˜ */
        --bg-color: #222;
        --text-color: #fff;
        --log-bg: rgba(255,255,255,0.05);
        --original-bg: rgba(255,255,255,0.2);
        --original-text: #fff;
        --translated-bg: rgba(255,255,255,0.8);
        --translated-text: #333;
        --timestamp-color: #ffd700;
        --button-bg: #1dd1a1;
        --button-hover-bg: #10ac84;
        --clear-bg: #f39c12;
        --clear-hover-bg: #e67e22;
        /* ë©”ë‰´ ë“œë¡­ë‹¤ìš´ ë°°ê²½ ë° ê·¸ë¦¼ì */
        --menu-bg: #333;
        --menu-shadow: 0 6px 12px rgba(0,0,0,0.5);
    }

    /* ë¼ì´íŠ¸ ëª¨ë“œ */
    body.light-mode {
        --bg-color: #f4f4f9;
        --text-color: #333;
        --log-bg: rgba(0,0,0,0.05);
        --original-bg: rgba(0,0,0,0.1);
        --original-text: #333;
        --translated-bg: #007bff;
        --translated-text: #fff;
        --timestamp-color: #007bff;
        --button-bg: #007bff;
        --button-hover-bg: #0056b3;
        --clear-bg: #ffc107;
        --clear-hover-bg: #ffae00;
        --menu-bg: #fff;
        --menu-shadow: 0 6px 12px rgba(0,0,0,0.2);
    }

    body {
        font-family: 'Segoe UI', Arial, sans-serif;
        margin:0;
        padding:15px;
        display:flex;
        flex-direction:column;
        height:100vh;
        background: var(--bg-color);
        color: var(--text-color);
        transition: background 0.3s, color 0.3s;
    }

    /* ë²„íŠ¼ ì»¨í…Œì´ë„ˆ (ì¢Œ/ìš° ë¶„ë¦¬) */
    #button-container {
        display: flex;
        margin-bottom: 15px;
        z-index: 10;
        width: 100%;
        justify-content: space-between;
        position: relative; /* ë“œë¡­ë‹¤ìš´ ê¸°ì¤€ì  */
    }
    #left-buttons {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    /* â­ï¸ ì˜¤ë¥¸ìª½ ì»¨í…Œì´ë„ˆëŠ” ìš”ì•½ ë²„íŠ¼ê³¼ í† ê¸€ ë©”ë‰´ë§Œ í¬í•¨ */
    #right-buttons {
        display: flex;
        gap: 10px;
        align-items: flex-start; /* ë“œë¡­ë‹¤ìš´ì„ ìƒë‹¨ ì •ë ¬ */
    }

    /* â­ï¸ [ë¦¬íŒ©í† ë§] ëª¨ë“  ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼ì„ .all-btn í´ë˜ìŠ¤ë¡œ í†µí•© */
    .all-btn {
        padding:8px 18px;
        cursor:pointer;
        background: var(--button-bg);
        border:none;
        border-radius:20px;
        font-weight:bold;
        box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        transition: background 0.3s, color 0.3s, transform 0.2s;
        color: var(--text-color);
        white-space: nowrap; /* í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ë°©ì§€ */
    }
    .all-btn:hover {
        background: var(--button-hover-bg);
        transform: scale(1.05);
    }

    /* â­ï¸ Clear ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    #clear-log-btn {
        background: var(--clear-bg);
        color: #333;
    }
    #clear-log-btn:hover {
        background: var(--clear-hover-bg);
    }

    /* â­ï¸ [ìˆ˜ì •] ì„¸ì…˜ ì œì–´ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    #session-control-btn {
        /* 'ì‹œì‘'ì¼ ë•ŒëŠ” ê¸°ë³¸ ë²„íŠ¼ ìƒ‰ (ë…¹ìƒ‰/íŒŒë‘) */
        background: var(--button-bg);
        color: var(--text-color);
    }
    #session-control-btn.session-active {
        /* 'ì¤‘ì§€' (í™œì„±) ìƒíƒœì¼ ë•ŒëŠ” ìœ„í—˜/ì¤‘ì§€ ìƒ‰ (ë¹¨ê°•) */
        background-color: #ff6347;
        color: #fff;
    }
    #session-control-btn.session-active:hover {
        background-color: #d9534f;
        transform: scale(1.05);
    }


    /* â­ï¸ ìœ í‹¸ë¦¬í‹° ë©”ë‰´ í† ê¸€ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ì•„ì´ì½˜ í˜•íƒœ) */
    #utility-menu-toggle {
        padding: 8px 12px;
        font-size: 1.2em;
    }

    /* â­ï¸ [ìˆ˜ì •] ìœ í‹¸ë¦¬í‹° ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ì»¨í…Œì´ë„ˆ */
    #utility-dropdown-menu {
        display: none; /* JSë¡œ í† ê¸€ */
        position: absolute;

        /* â­ï¸ ì˜¤ë¥¸ìª½ ìµœìƒë‹¨ì— ê³ ì • */
        top: 50px;
        right: 0;

        padding: 10px;
        background: var(--menu-bg);
        border-radius: 10px;
        box-shadow: var(--menu-shadow);
        z-index: 20;
        flex-direction: column;
        gap: 10px;
        border: 1px solid rgba(255,255,255,0.1);
        width: 240px; /* ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ë„ˆë¹„ ê³ ì • */
    }

    /* â­ï¸ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ë‚´ë¶€ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì¡°ì • (ì–¸ì–´/í…Œë§ˆ ë²„íŠ¼ ê¸°ì¤€) */
    #utility-dropdown-menu .all-btn {
        width: 100%;
        box-shadow: none;
        border-radius: 8px;
        padding: 10px 15px;
    }

    /* â­ï¸ [ì‹ ê·œ] ì €ì¥ ì˜µì…˜ ê·¸ë£¹ ìŠ¤íƒ€ì¼ */
    .save-options-group {
        display: flex;
        gap: 5px;
        width: 100%;
    }
    .save-options-group .all-btn {
        flex: 1; /* ë‘ ë²„íŠ¼ì´ ê³µê°„ì„ ê· ë“±í•˜ê²Œ ì°¨ì§€ */
        padding: 8px 10px;
        border-radius: 8px;
        font-size: 0.9em;
        white-space: normal;
        line-height: 1.2;
    }


    /* â­ï¸ ì„¤ì • í•­ëª© ìŠ¤íƒ€ì¼ (ì¤Œ/í°íŠ¸ ì»¨íŠ¸ë¡¤ì„ ìœ„í•´ ì¬ì •ì˜) */
    .setting-item {
        margin-bottom: 5px;
        padding: 0;
    }
    .setting-item:first-of-type {
        border-top: none;
        padding-top: 0;
        margin-top: 0;
    }
    .setting-item:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
    }
    .setting-item label {
        display: block;
        margin-bottom: 5px;
        font-size: 0.9em;
        font-weight: normal;
        padding-left: 5px;
    }

    /* â­ï¸ ì¤Œ/í°íŠ¸ ì»¨íŠ¸ë¡¤ ìŠ¤íƒ€ì¼: ì–‘ì˜† ì •ë ¬ëœ í•œ ì¤„ êµ¬ì¡° */
    .zoom-controls {
        display: flex;
        justify-content: space-between;
        align-items: stretch;
        gap: 0;
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid var(--button-bg);
        height: 40px;
    }

    /* â­ï¸ zoom-controls ë‚´ë¶€ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .zoom-controls button {
        padding: 0 10px;
        height: 100%;
        background: var(--button-bg);
        border: none;
        border-radius: 0;
        cursor: pointer;
        color: var(--text-color);
        font-weight: bold;
        box-shadow: none;
        transition: background 0.3s;

        flex-grow: 1; /* 1/4 ì°¨ì§€ */
        flex-shrink: 0;
        font-size: 1.0em;
        width: auto;
    }
    .zoom-controls button:hover {
        background: var(--button-hover-bg);
        transform: none;
    }

    /* â­ï¸ ì„¤ì • ê°’ í‘œì‹œ (span) ìŠ¤íƒ€ì¼ (ì¤‘ì•™ ì˜ì—­) */
    #zoom-level, #font-size-level {
        font-size: 1.0em;
        font-weight: bold;
        text-align: center;
        flex-grow: 2; /* 2/4 ì°¨ì§€ */
        background: var(--menu-bg);
        color: var(--text-color);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0 5px;
        height: 100%;
        white-space: nowrap;

        border-left: 1px solid rgba(255, 255, 255, 0.1);
        border-right: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* ì½˜í…ì¸  ì˜ì—­ */
    #content-container {
        flex: 1;
        display: flex;
        min-height: 0;
    }

    #log {
        flex: 1;
        overflow-y:auto;
        display:flex;
        flex-direction:column;
        gap:12px;
        padding:12px;
        border-radius:15px;
        background: var(--log-bg);
        transition: background 0.3s;
    }

    /* â­ï¸ [ì‹ ê·œ] ì‹œìŠ¤í…œ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
    .system-message {
        text-align: center;
        font-style: italic;
        color: var(--timestamp-color);
        width: 100%;
        font-size: 0.9em;
        margin: 5px 0;
        font-weight: bold;
    }

    /* ë¡œê·¸ í•­ëª© ìŠ¤íƒ€ì¼ (í°íŠ¸ í¬ê¸°/ì¢…ë¥˜ ë³€ìˆ˜ ì ìš©) */
    .log-entry {
        display:flex;
        flex-direction:column;
        gap:6px;
        opacity:0;
        transform: translateY(10px);
        transition: opacity 0.3s ease, transform 0.3s ease;
    }
    .log-entry.show {
        opacity:1;
        transform: translateY(0);
    }
    .original, .translated {
        max-width:70%;
        padding:10px 14px;
        border-radius:22px;
        word-wrap:break-word;
        font-size: var(--log-font-size);
        font-family: var(--log-font-family); /* â­ï¸ [ê¸°ë³¸ê°’ ê³ ì •] ë³€ìˆ˜ ì ìš© */
        transition: background 0.3s, color 0.3s, font-size 0.3s; /* í°íŠ¸ ì¢…ë¥˜ ì „í™˜ ì œê±° */
    }
    .original {
        background: var(--original-bg);
        color: var(--original-text);
        align-self:flex-start;
    }
    .translated {
        background: var(--translated-bg);
        color: var(--translated-text);
        align-self:flex-end;
    }
    .timestamp {
        font-size:0.75em;
        color: var(--timestamp-color);
        text-align:center;
        transition: color 0.3s;
    }

    #summary-log, #summary-content, #summary-close { display: none; }
</style>
</head>
<body>
    <div id="button-container">
        <div id="left-buttons">
            <button id="clear-log-btn" class="all-btn">Clear!</button>
            <button id="session-control-btn" class="all-btn">Start Translation</button>
        </div>

        <div id="right-buttons">
            <button id="toggle-summary" class="all-btn">ìš”ì•½ ìƒˆ ì°½ ì—´ê¸°</button>

            <button id="utility-menu-toggle" class="all-btn" title="ê¸°íƒ€ ê¸°ëŠ¥">â€¢â€¢â€¢</button>

            <div id="utility-dropdown-menu">
                <button class="all-btn" id="lang-toggle-btn">ğŸ‡ºğŸ‡¸ ì˜ì–´ ì„ íƒ ì¤‘</button>

                <button id="toggle-theme" class="all-btn">ğŸŒ™ ë‹¤í¬ ëª¨ë“œ</button>

                <div class="save-options-group">
                    <button id="save-original-log-btn" class="all-btn">ğŸ’¾ ì›ë¬¸ ì €ì¥</button>
                    <button id="save-translated-log-btn" class="all-btn">ğŸ’¾ ë²ˆì—­ ì €ì¥</button>
                </div>

                <div class="setting-item">
                    <label>í™”ë©´ í™•ëŒ€/ì¶•ì†Œ</label>
                    <div class="zoom-controls">
                        <button id="zoom-out-btn">-</button>
                        <span id="zoom-level">100%</span>
                        <button id="zoom-in-btn">+</button>
                    </div>
                </div>

                <div class="setting-item">
                    <label>ë²ˆì—­ ë¡œê·¸ í°íŠ¸ í¬ê¸°</label>
                    <div class="zoom-controls">
                        <button id="font-decrease-btn">A-</button>
                        <span id="font-size-level">ê¸°ë³¸</span>
                        <button id="font-increase-btn">A+</button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div id="content-container">
        <div id="log"></div>
    </div>

<script>
    const socket = io();
    const body = document.body;
    const logDiv = document.getElementById("log");
    const toggleBtn = document.getElementById("toggle-summary");
    const logs = [];

    // â­ï¸ ìœ í‹¸ë¦¬í‹° ë©”ë‰´ ê´€ë ¨ ë³€ìˆ˜
    const utilityMenuToggle = document.getElementById("utility-menu-toggle");
    const utilityDropdownMenu = document.getElementById("utility-dropdown-menu");

    // â­ï¸ í†µí•©ëœ ë©”ë‰´ ë‚´ë¶€ ë²„íŠ¼ ë³€ìˆ˜
    const themeBtn = document.getElementById("toggle-theme");
    const langToggleBtn = document.getElementById("lang-toggle-btn");

    // â­ï¸ [ìˆ˜ì •] ë¡œê·¸ ì €ì¥ ë²„íŠ¼ ë³€ìˆ˜ (ì´ì§€ì„ ë‹¤í˜• ë²„íŠ¼ ê·¸ë£¹)
    const saveOriginalLogBtn = document.getElementById("save-original-log-btn");
    const saveTranslatedLogBtn = document.getElementById("save-translated-log-btn");

    // â­ï¸ ì„¤ì • ìš”ì†Œ ë³€ìˆ˜
    const zoomInBtn = document.getElementById("zoom-in-btn");
    const zoomOutBtn = document.getElementById("zoom-out-btn");
    const zoomLevelSpan = document.getElementById("zoom-level");
    const fontDecreaseBtn = document.getElementById("font-decrease-btn");
    const fontIncreaseBtn = document.getElementById("font-increase-btn");
    const fontSizeLevelSpan = document.getElementById("font-size-level");

    // â­ï¸ ê¸€ê¼´ ì¢…ë¥˜ë¥¼ ê³ ì •ê°’ìœ¼ë¡œ ì„¤ì •
    const currentFontFamily = "'Segoe UI', Arial, sans-serif";

    // â­ï¸ ë¡œê·¸ í´ë¦¬ì–´ ë²„íŠ¼ ë³€ìˆ˜
    const clearLogBtn = document.getElementById("clear-log-btn");

    // â­ï¸ ì„¸ì…˜ ì œì–´ ë²„íŠ¼ ë³€ìˆ˜
    const sessionControlBtn = document.getElementById("session-control-btn");
    let currentSessionId = "";

    let summaryWindow = null;
    let currentTheme = localStorage.getItem('theme') || 'dark';
    // â­ï¸ ê¸°ë³¸ ì–¸ì–´ëŠ” ë¡œì»¬ì— ì—†ìœ¼ë©´ 'en' (ì˜ì–´)ê°€ ê¸°ë³¸ê°’
    let currentLang = localStorage.getItem('lang') || 'en';
    let currentZoom = 1.0;
    const zoomStep = 0.1;
    let currentFontSize = parseInt(localStorage.getItem('fontSize') || '14');
    const fontSizeStep = 2;

    // --- ì´ˆê¸°í™” ì‹¤í–‰ ---
    applyTheme(currentTheme);
    updateLangButton(currentLang);
    updateZoom(currentZoom);
    updateFontSize(currentFontSize, false);
    // ---------------------

    // â­ï¸ ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì¶”ê°€ í—¬í¼ í•¨ìˆ˜
    function addSystemMessage(message) {
        const msgDiv = document.createElement("div");
        msgDiv.classList.add("system-message");
        msgDiv.textContent = message;
        logDiv.appendChild(msgDiv);
        logDiv.scrollTop = logDiv.scrollHeight;
    }

    // --- í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë©”ì‹œì§€ ---
    document.addEventListener("DOMContentLoaded", () => {
        addSystemMessage("ì„œë²„ ì¤€ë¹„ ì™„ë£Œ. 'Start Translation'ì„ ëˆŒëŸ¬ ì„¸ì…˜ì„ ì‹œì‘í•˜ì„¸ìš”.");
    });


    // â­ï¸ ë¡œê·¸ Clear (ì „ì²´ ì‚­ì œ) ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    clearLogBtn.addEventListener('click', () => {
        if (confirm("ì •ë§ë¡œ ëª¨ë“  ë¡œê·¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) {
            logs.length = 0;
            renderLogs(logDiv, logs, false);
            console.log("ğŸ”¥ ëª¨ë“  ë¡œê·¸ í•­ëª©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            addSystemMessage("ë¡œê·¸ê°€ ìˆ˜ë™ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
        }
    });

    // â­ï¸ [ìˆ˜ì •] ë¡œê·¸ ì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ì´ì§€ì„ ë‹¤í˜•)
    saveOriginalLogBtn.addEventListener('click', () => {
        // [ìˆ˜ì •] ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ë‹«ê¸° ë¡œì§ì€ ë” ì´ìƒ í•„ìš” ì—†ìœ¼ë‚˜, í˜„ì¬ ì—´ë¦° ë©”ë‰´ê°€ ìˆë‹¤ë©´ ë‹«íˆë„ë¡ ë¡œì§ ìœ ì§€ ê°€ëŠ¥
        saveLogToFile('original');
    });

    saveTranslatedLogBtn.addEventListener('click', () => {
        // [ìˆ˜ì •] ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ë‹«ê¸° ë¡œì§ì€ ë” ì´ìƒ í•„ìš” ì—†ìœ¼ë‚˜, í˜„ì¬ ì—´ë¦° ë©”ë‰´ê°€ ìˆë‹¤ë©´ ë‹«íˆë„ë¡ ë¡œì§ ìœ ì§€ ê°€ëŠ¥
        saveLogToFile('translated');
    });

    // â­ï¸ ë¡œê·¸ íŒŒì¼ ì €ì¥ í•¨ìˆ˜ (type ì¸ìˆ˜ë¡œ ì €ì¥í•  ë¡œê·¸ ì¢…ë¥˜ ì§€ì •)
    /**
     * @param {'original' | 'translated'} type ì €ì¥í•  ë¡œê·¸ ì¢…ë¥˜
     */
    function saveLogToFile(type) {
        if (logs.length === 0) {
            alert("ì €ì¥í•  ë¡œê·¸ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }

        let logContent;
        let fileTypePrefix;

        if (type === 'original') {
            logContent = logs.map(data => `[${data.time}] ${data.original}`).join('\n');
            fileTypePrefix = "Original_";
        } else if (type === 'translated') {
            logContent = logs.map(data => `[${data.time}] ${data.translated}`).join('\n');
            fileTypePrefix = "Translated_";
        } else {
            console.error("ì˜ëª»ëœ ë¡œê·¸ íƒ€ì…ì´ ì „ë‹¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
            return;
        }

        // íŒŒì¼ ì´ë¦„ ìƒì„±: ì„¸ì…˜ IDê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ë‚ ì§œ/ì‹œê°„ ì‚¬ìš©
        const defaultName = currentSessionId
            ? `${fileTypePrefix}Log_${currentSessionId}`
            : `${fileTypePrefix}Log_${new Date().toLocalISOString().slice(0, 19).replace(/[:T]/g, '-')}`;

        const fileName = prompt("ì €ì¥í•  íŒŒì¼ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:", defaultName) || defaultName;

        // Blobì„ ì‚¬ìš©í•˜ì—¬ í…ìŠ¤íŠ¸ íŒŒì¼ ìƒì„±
        const blob = new Blob([logContent], { type: 'text/plain;charset=utf-8' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = fileName + '.txt';

        // ë‹¤ìš´ë¡œë“œ ì‹¤í–‰
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        console.log(`ğŸ’¾ ${type} ë¡œê·¸ê°€ '${fileName}.txt'ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        addSystemMessage(`${type} ë¡œê·¸ê°€ íŒŒì¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤: ${fileName}.txt`);
    }

    // â­ï¸ ì„¸ì…˜ ì œì–´ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (ë¡œì§ ë¶„ë¦¬)
    sessionControlBtn.addEventListener('click', () => {
        const currentText = sessionControlBtn.textContent;

        if (currentText === 'Start Translation') {
            // --- 1. ì‹œì‘ ë¡œì§ ---
            const promptMessage = 'ìƒˆ ì„¸ì…˜ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:';
            // (ì˜¤ëŠ˜ ë‚ ì§œì™€ ì‹œê°„ìœ¼ë¡œ ê¸°ë³¸ê°’ ì œì•ˆ)
            const defaultName = new Date().toLocalISOString().slice(0, 16).replace('T', '_');
            const sessionId = prompt(promptMessage, defaultName);

            if (sessionId && sessionId.trim() !== "") {
                const trimmedId = sessionId.trim();
                console.log(`ğŸš€ 'start_translation_session' ìš”ì²­ ì „ì†¡ (ID: ${trimmedId})`);
                addSystemMessage(`'${trimmedId}' ì„¸ì…˜ ì‹œì‘ ìš”ì²­ ì¤‘... (ì„œë²„ ì‘ë‹µ ëŒ€ê¸°)`);
                socket.emit("start_translation_session", {
                    session_id: trimmedId
                });
            } else {
                console.log("ì„¸ì…˜ ì‹œì‘ ì·¨ì†Œ.");
            }

        } else if (currentText === 'End Session') {
            // --- 2. ì¤‘ì§€ ë¡œì§ ---
            if (confirm("í˜„ì¬ ë²ˆì—­ ì„¸ì…˜ì„ ì¤‘ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                console.log("ğŸš€ 'stop_translation_session' ìš”ì²­ ì „ì†¡");
                addSystemMessage("ì„¸ì…˜ ì¤‘ì§€ ìš”ì²­ ì¤‘...");
                socket.emit("stop_translation_session", {});
            }
        }
    });

    // (Helper for prompt)
    Date.prototype.toLocalISOString = function() {
        var tzo = -this.getTimezoneOffset(),
            dif = tzo >= 0 ? '+' : '-',
            pad = function(num) { return (num < 10 ? '0' : '') + num; };
        return this.getFullYear() +
            '-' + pad(this.getMonth() + 1) +
            '-' + pad(this.getDate()) +
            'T' + pad(this.getHours()) +
            ':' + pad(this.getMinutes());
    }


    // â­ï¸ ìœ í‹¸ë¦¬í‹° ë©”ë‰´ í† ê¸€ ê¸°ëŠ¥
    utilityMenuToggle.addEventListener('click', (event) => {
        event.stopPropagation();
        const isHidden = utilityDropdownMenu.style.display === 'flex';
        utilityDropdownMenu.style.display = isHidden ? 'none' : 'flex';
    });

    // â­ï¸ ë©”ë‰´ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    document.addEventListener('click', (event) => {
        if (utilityDropdownMenu.style.display === 'flex' &&
            !utilityDropdownMenu.contains(event.target) &&
            event.target !== utilityMenuToggle) {

            utilityDropdownMenu.style.display = 'none';
        }
    });


    // â­ï¸ ì–¸ì–´ í† ê¸€ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    langToggleBtn.addEventListener("click", (event) => {
        event.stopPropagation();
        // 'en' (ì˜ì–´)ì™€ 'ja' (ì¼ë³¸ì–´)ë¥¼ í† ê¸€
        const newLang = currentLang === "en" ? "ja" : "en";

        currentLang = newLang;
        updateLangButton(newLang);
        localStorage.setItem('lang', newLang);

        socket.emit("change_language", {
            language: newLang,
            target: 'ko'
        });
        console.log(`ğŸ§ ì–¸ì–´ ë³€ê²½ ìš”ì²­: ${newLang} -> ko`);
    });

    // â­ï¸ ì–¸ì–´ ë²„íŠ¼ UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (í†µí•© ë²„íŠ¼ìš©)
    function updateLangButton(lang) {
        if (lang === "en") {
            langToggleBtn.textContent = "ğŸ‡ºğŸ‡¸ ì˜ì–´ ì„ íƒ ì¤‘";
        } else if (lang === "ja") {
            langToggleBtn.textContent = "ğŸ‡¯ğŸ‡µ ì¼ë³¸ì–´ ì„ íƒ ì¤‘";
        } else {
            langToggleBtn.textContent = "Language ğŸ‡¯ğŸ‡µ/ğŸ‡ºğŸ‡¸";
        }
    }

    // â­ï¸ í…Œë§ˆ í† ê¸€ ë²„íŠ¼ ë¦¬ìŠ¤ë„ˆ
    themeBtn.addEventListener('click', (event) => {
        event.stopPropagation();
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        applyTheme(newTheme);
    });

    // â­ï¸ íŒì—… ì°½ í†µì‹  í•¨ìˆ˜ (2ê°œ)
    window.requestSpecificSummaryFromPopup = (sessionId) => {
        if (sessionId) {
            socket.emit("request_specific_summary", { session_id: sessionId });
            if (summaryWindow && !summaryWindow.closed) {
                const summaryTextDiv = summaryWindow.document.getElementById('summary-text');
                if (summaryTextDiv) summaryTextDiv.textContent = '[ì„ íƒí•œ ì„¸ì…˜ ìš”ì•½ ë¡œë“œ ì¤‘...]';
            }
        }
    }
    window.requestRenameSessionFromPopup = (oldId, newId) => {
        if (oldId && newId) {
            socket.emit("request_rename_session", { old_id: oldId, new_id: newId });
            if (summaryWindow && !summaryWindow.closed) {
                const summaryTextDiv = summaryWindow.document.getElementById('summary-text');
                if (summaryTextDiv) summaryTextDiv.textContent = `[ì´ë¦„ ë³€ê²½ ì¤‘...]`;
            }
        }
    }

    // â­ï¸ [ì‹ ê·œ] ìš”ì•½ íŒŒì¼ ì €ì¥ í•¨ìˆ˜ (íŒì—…ì—ì„œ í˜¸ì¶œ)
    /**
     * @param {string} summaryContent ì €ì¥í•  ìš”ì•½ í…ìŠ¤íŠ¸
     * @param {string} sessionId í˜„ì¬ ì„ íƒëœ ì„¸ì…˜ ID
     */
    window.saveSummaryToFile = (summaryContent, sessionId) => {
        if (!summaryContent || summaryContent.trim() === "" || summaryContent.includes('[ìš”ì•½ ìƒì„± ì¤‘...]')) {
            alert("ì €ì¥í•  ìš”ì•½ ë‚´ìš©ì´ ì—†ê±°ë‚˜ ë¡œë“œ ì¤‘ì…ë‹ˆë‹¤.");
            return;
        }

        const defaultName = sessionId && !sessionId.startsWith('[')
            ? `Summary_of_${sessionId}`
            : `Summary_Log_${new Date().toLocalISOString().slice(0, 19).replace(/[:T]/g, '-')}`;

        const fileName = prompt("ì €ì¥í•  íŒŒì¼ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:", defaultName) || defaultName;

        // Blobì„ ì‚¬ìš©í•˜ì—¬ í…ìŠ¤íŠ¸ íŒŒì¼ ìƒì„±
        const blob = new Blob([summaryContent], { type: 'text/plain;charset=utf-8' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = fileName + '.txt';

        // ë‹¤ìš´ë¡œë“œ ì‹¤í–‰
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        console.log(`ğŸ’¾ ìš”ì•½ ë¡œê·¸ê°€ '${fileName}.txt'ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        addSystemMessage(`ìš”ì•½ ë‚´ìš©ì´ íŒŒì¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤: ${fileName}.txt`);
    }

    // â­ï¸ ì¤Œ/í°íŠ¸ í¬ê¸° í•¨ìˆ˜
    function updateZoom(newZoom) {
        currentZoom = Math.max(0.5, Math.min(2.0, newZoom));
        document.body.style.zoom = currentZoom;
        zoomLevelSpan.textContent = `${Math.round(currentZoom * 100)}%`;
    }

    function updateFontSize(newSize, save=true) {
        currentFontSize = Math.max(10, Math.min(24, newSize));
        // 1. CSS ë³€ìˆ˜ ì—…ë°ì´íŠ¸ (ë©”ì¸ ìœˆë„ìš°)
        document.documentElement.style.setProperty('--log-font-size', `${currentFontSize}px`);

        // 2. íŒì—… ìœˆë„ìš° ìŠ¤íƒ€ì¼ ë™ê¸°í™” (í°íŠ¸ í¬ê¸°)
        if (summaryWindow && !summaryWindow.closed) {
            const popupDoc = summaryWindow.document;
            popupDoc.body.style.fontSize = `${currentFontSize}px`; // íŒì—… body í°íŠ¸ í¬ê¸° ì¡°ì •
        }

        // 3. ë ˆë²¨ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        let levelText = "ê¸°ë³¸";
        if (currentFontSize > 14) levelText = `+${(currentFontSize - 14) / fontSizeStep}`;
        else if (currentFontSize < 14) levelText = `-${(14 - currentFontSize) / fontSizeStep}`;
        fontSizeLevelSpan.textContent = levelText;

        if (save) {
            localStorage.setItem('fontSize', currentFontSize);
            console.log(`ğŸ“ í°íŠ¸ í¬ê¸° ë³€ê²½: ${currentFontSize}px`);
        }
    }

    // â­ï¸ ì¤Œ/í°íŠ¸ í¬ê¸° ë¦¬ìŠ¤ë„ˆ
    zoomInBtn.addEventListener('click', () => updateZoom(currentZoom + zoomStep));
    zoomOutBtn.addEventListener('click', () => updateZoom(currentZoom - zoomStep));
    fontIncreaseBtn.addEventListener('click', () => updateFontSize(currentFontSize + fontSizeStep));
    fontDecreaseBtn.addEventListener('click', () => updateFontSize(currentFontSize - fontSizeStep));


    // â­ï¸ í…Œë§ˆ ì ìš© í•¨ìˆ˜ (íŒì—… ë™ê¸°í™” í¬í•¨)
    function applyTheme(theme) {
        if (theme === 'light') {
            body.classList.add('light-mode');
            themeBtn.innerHTML = "ğŸŒ™ ë‹¤í¬ ëª¨ë“œ";
        } else {
            body.classList.remove('light-mode');
            themeBtn.innerHTML = "ğŸŒ ë¼ì´íŠ¸ ëª¨ë“œ";
        }
        localStorage.setItem('theme', theme);
        currentTheme = theme;

        if (summaryWindow && !summaryWindow.closed) {
            // íŒì—… ì°½ í…Œë§ˆ ì¦‰ì‹œ ë™ê¸°í™” (ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ë¡œ êµ¬í˜„)
            const doc = summaryWindow.document;
            const isLight = theme === 'light';

            const popupBg = isLight ? '#f4f4f9' : '#222';
            const popupText = isLight ? '#333' : '#fff';
            const popupHighlight = isLight ? '#007bff' : '#1dd1a1';
            const popupBorder = isLight ? '#ddd' : '#555';
            const popupInputBg = isLight ? '#fff' : '#444';
            const popupSummaryBg = isLight ? '#f9f9f9' : '#2a2a2a';
            const renameBtnBg = popupHighlight;
            const renameBtnColor = popupText;
            const renameBtnHoverBg = isLight ? '#0056b3' : '#10ac84';

            // íŒì—… ë¬¸ì„œì˜ bodyì— ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ì ìš©
            doc.body.style.background = popupBg;
            doc.body.style.color = popupText;
            const h1Element = doc.querySelector('h1');
            if(h1Element) h1Element.style.color = popupHighlight;
            const sessionSelectElement = doc.getElementById('session-select');
            if(sessionSelectElement) {
                sessionSelectElement.style.borderColor = popupBorder;
                sessionSelectElement.style.background = popupInputBg;
                sessionSelectElement.style.color = popupText;
            }
            const summaryTextElement = doc.getElementById('summary-text');
            if(summaryTextElement) {
                summaryTextElement.style.borderColor = popupBorder;
                summaryTextElement.style.background = popupSummaryBg;
            }
            const renameBtnElement = doc.getElementById('rename-btn');
            if(renameBtnElement) {
                renameBtnElement.style.background = renameBtnBg;
                renameBtnElement.style.color = renameBtnColor;
            }
        }
    }


    // â­ï¸ íŒì—… ì°½ ì—´ê¸° í•¨ìˆ˜ (ì—¬ê¸°ì„œ íŒì—… ì°½ì˜ ì´ˆê¸° ìŠ¤íƒ€ì¼ì„ ì„¤ì •)
    function openSummaryWindow() {
        if (summaryWindow && !summaryWindow.closed) {
            summaryWindow.focus();
            socket.emit("request_summary", {});
            return;
        }

        const windowFeatures = 'width=500,height=600,scrollbars=yes,resizable=yes,top=100,left=100';
        summaryWindow = window.open('', 'SummaryPopup', windowFeatures);

        if (summaryWindow) {
            const isLight = currentTheme === 'light';
            const popupBg = isLight ? '#f4f4f9' : '#222';
            const popupText = isLight ? '#333' : '#fff';
            const popupHighlight = isLight ? '#007bff' : '#1dd1a1';
            const popupBorder = isLight ? '#ddd' : '#555';
            const popupInputBg = isLight ? '#fff' : '#444';
            const popupSummaryBg = isLight ? '#f9f9f9' : '#2a2a2a';
            const renameBtnBg = popupHighlight;
            const renameBtnColor = popupText;
            const renameBtnHoverBg = isLight ? '#0056b3' : '#10ac84';

            // â­ï¸ íŒì—… ìŠ¤íƒ€ì¼ ì‹œíŠ¸ ë‚´ì— ê¸€ê¼´ ë° í°íŠ¸ í¬ê¸° ì´ˆê¸° ê°’ì„ ì„¤ì •í•©ë‹ˆë‹¤. (ê¸€ê¼´ì€ ê³ ì •)
            const popupHTML = `
                <!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><title>íšŒì˜ ìš”ì•½</title>
                <style>
                    body {
                        font-family: ${currentFontFamily}; /* â­ï¸ ê³ ì •ëœ ê¸€ê¼´ ì ìš© */
                        font-size: ${currentFontSize}px; /* â­ï¸ ì´ˆê¸° í°íŠ¸ í¬ê¸° ì ìš© */
                        margin: 0; padding: 20px;
                        background: ${popupBg}; color: ${popupText}; line-height: 1.6;
                        transition: background 0.3s, color 0.3s, font-size 0.3s;
                    }
                    h1 { text-align: center; color: ${popupHighlight}; margin-bottom: 20px; font-size: 1.5em; }
                    #session-controls { display: flex; gap: 10px; margin-bottom: 15px; align-items: stretch; }
                    #session-controls label { font-weight: bold; padding: 8px 0; }
                    #session-select { flex: 1; padding: 8px; border-radius: 5px; border: 1px solid ${popupBorder}; background: ${popupInputBg}; color: ${popupText}; font-size: 0.9em; }
                    #rename-btn { padding: 8px 12px; border-radius: 5px; border: none; background: ${renameBtnBg}; color: ${renameBtnColor}; cursor: pointer; font-weight: bold; font-size: 0.9em; transition: background 0.3s; }
                    #rename-btn:hover { background: ${renameBtnHoverBg}; }

                    /* â­ï¸ [ì¶”ê°€] ìš”ì•½ ì €ì¥ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
                    #save-summary-btn {
                        padding: 8px 12px; border-radius: 5px; border: none;
                        background: #f39c12; color: #333; cursor: pointer;
                        font-weight: bold; font-size: 0.9em;
                        transition: background 0.3s;
                    }
                    #save-summary-btn:hover { background: #e67e22; }

                    #summary-text {
                        white-space: pre-wrap; border: 1px solid ${popupBorder}; padding: 15px; border-radius: 8px;
                        background: ${popupSummaryBg}; min-height: 300px;
                        font-family: ${currentFontFamily}; /* â­ï¸ ìš”ì•½ í…ìŠ¤íŠ¸ì—ë„ ê¸€ê¼´ ì ìš© */
                        font-size: 1em; /* body ê¸°ì¤€ìœ¼ë¡œ */
                    }
                </style>
                </head><body>
                    <h1>íšŒì˜ ìš”ì•½</h1>
                    <div id="session-controls">
                        <label for="session-select">ì„¸ì…˜:</label>
                        <select id="session-select"><option value="">[ë¡œë“œ ì¤‘...]</option></select>
                        <button id="rename-btn">ì´ë¦„ ë³€ê²½</button>
                        <button id="save-summary-btn">ğŸ’¾ ìš”ì•½ ì €ì¥</button>
                    </div>
                    <div id="summary-text">[ìš”ì•½ ìƒì„± ì¤‘...]</div>
                    <script>
                        const sessionSelect = document.getElementById('session-select');
                        const renameBtn = document.getElementById('rename-btn');
                        // â­ï¸ [ì¶”ê°€] ìš”ì•½ ì €ì¥ ë²„íŠ¼ ë³€ìˆ˜
                        const saveSummaryBtn = document.getElementById('save-summary-btn');

                        sessionSelect.addEventListener('change', () => {
                            const selectedSessionId = sessionSelect.value;
                            if (selectedSessionId && window.opener && typeof window.opener.requestSpecificSummaryFromPopup === 'function') {
                                window.opener.requestSpecificSummaryFromPopup(selectedSessionId);
                            }
                        });

                        renameBtn.addEventListener('click', () => {
                            const oldId = sessionSelect.value;
                            if (!oldId || oldId.startsWith('[')) { alert("ì´ë¦„ì„ ë³€ê²½í•  ì„¸ì…˜ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."); return; }
                            const newId = prompt("ìƒˆë¡œìš´ ì„¸ì…˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:", oldId);
                            if (newId === null || newId.trim() === "" || newId.trim() === oldId) { return; }
                            if (window.opener && typeof window.opener.requestRenameSessionFromPopup === 'function') {
                                window.opener.requestRenameSessionFromPopup(oldId, newId.trim());
                            }
                        });

                        // â­ï¸ [ì¶”ê°€] ìš”ì•½ ì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
                        saveSummaryBtn.addEventListener('click', () => {
                            const summaryText = document.getElementById('summary-text').textContent;
                            const sessionId = sessionSelect.value;
                            // ë©”ì¸ ì°½ì˜ saveSummaryToFile í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
                            if (window.opener && typeof window.opener.saveSummaryToFile === 'function') {
                                window.opener.saveSummaryToFile(summaryText, sessionId);
                            } else {
                                alert("ì €ì¥ ê¸°ëŠ¥ì„ ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë©”ì¸ ì°½ì„ í™•ì¸í•˜ì„¸ìš”.");
                            }
                        });

                    <\/script>
                </body></html>
            `;
            summaryWindow.document.write(popupHTML);
            summaryWindow.document.close();
            socket.emit("request_summary", {});
        } else {
            alert("íŒì—… ì°½ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
        }
    }

    toggleBtn.addEventListener("click", openSummaryWindow);

    // ----------------------------------------------------
    // âœ¨ Socket.IO ì—°ë™ ë¡œì§
    // ----------------------------------------------------
    socket.on("connect", () => {
        console.log("âœ… ì„œë²„ ì—°ê²° ì„±ê³µ");

        // â­ï¸ ì„œë²„ ì—°ê²° ì‹œ ë¡œì»¬ì— ì €ì¥ëœ/ê¸°ë³¸ê°’ì¸ ì–¸ì–´ë¥¼ ì„œë²„ì— ì¦‰ì‹œ ì „ì†¡
        // ê¸°ë³¸ê°’ì€ 'en' (ì˜ì–´)ì…ë‹ˆë‹¤.
        socket.emit("change_language", {
            language: currentLang,
            target: 'ko'
        });
        console.log(`ğŸ§ ì„œë²„ ì—°ê²° ì‹œ ê¸°ë³¸ ì–¸ì–´ ìš”ì²­: ${currentLang} -> ko`);
    });

    // 1. ì‹¤ì‹œê°„ ë²ˆì—­ ë¡œê·¸ ìˆ˜ì‹ 
    socket.on("partial_translation", data => {
        logs.push(data);
        renderLogs(logDiv, logs, true);
    });

    // 2. ì„œë²„ì—ì„œ ìš”ì•½ ë°ì´í„° ìˆ˜ì‹  (ìš”ì•½ ì°½ ì—…ë°ì´íŠ¸)
    socket.on("summary_data_updated", data => {
        console.log("âœ… ìš”ì•½ ë°ì´í„° ìˆ˜ì‹ :", data);
        if (!summaryWindow || summaryWindow.closed) return;
        const summaryTextDiv = summaryWindow.document.getElementById('summary-text');
        if (summaryTextDiv) summaryTextDiv.textContent = data.summary;

        if (data.all_sessions) {
            const sessionSelect = summaryWindow.document.getElementById('session-select');
            if (sessionSelect) {
                sessionSelect.innerHTML = "";
                data.all_sessions.forEach(sessionId => {
                    const option = summaryWindow.document.createElement('option');
                    option.value = sessionId;
                    option.textContent = sessionId;
                    sessionSelect.appendChild(option);
                });
            }
        }
        if (data.current_session_id) {
            const sessionSelect = summaryWindow.document.getElementById('session-select');
            if (sessionSelect) sessionSelect.value = data.current_session_id;
        }
    });

    // â­ï¸ 3. ì„œë²„ì—ì„œ ì–¸ì–´ ë³€ê²½ ì™„ë£Œ ìˆ˜ì‹  (í•„ìš” ì‹œ)
    socket.on("language_changed", data => {
        console.log(`âœ… ì„œë²„ê°€ ì–¸ì–´ ë³€ê²½ í™•ì¸: ${data.language}`);
        // (í•„ìš” ì‹œ: "ì–¸ì–´ ë³€ê²½ ì™„ë£Œ" ê°™ì€ ì•Œë¦¼ í† ìŠ¤íŠ¸ íŒì—…)
    });

    // â­ï¸ 4. ì„œë²„ë¡œë¶€í„° ìƒˆ ì„¸ì…˜ì´ ì‹œì‘ë˜ì—ˆìŒì„ í™•ì¸
    socket.on("new_session_started", data => {
        console.log(`âœ… ì„œë²„ê°€ ìƒˆ ì„¸ì…˜ ì‹œì‘ í™•ì¸: ${data.session_id}`);

        // â­ï¸ ì„¸ì…˜ ID ì €ì¥
        currentSessionId = data.session_id;

        // 1. ë¡œì»¬ ë¡œê·¸ ë°°ì—´ ë¹„ìš°ê¸°
        logs.length = 0;
        renderLogs(logDiv, logs, false);

        // 2. ë²„íŠ¼ í…ìŠ¤íŠ¸ì™€ ìŠ¤íƒ€ì¼ ë³€ê²½ (í™œì„± ìƒíƒœ)
        sessionControlBtn.textContent = "End Session";
        sessionControlBtn.classList.add("session-active");

        // 3. ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì¶”ê°€
        addSystemMessage(`--- ìƒˆ ì„¸ì…˜ '${data.session_id}'ì´(ê°€) ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ---`);
    });

    // â­ï¸ 5. ì„¸ì…˜ ì‹œì‘ ì‹¤íŒ¨ ì‹œ
    socket.on("session_start_failed", data => {
        console.error(`âŒ ì„¸ì…˜ ì‹œì‘ ì‹¤íŒ¨: ${data.error}`);
        addSystemMessage(`[ì˜¤ë¥˜] ì„¸ì…˜ ì‹œì‘ ì‹¤íŒ¨: ${data.error}`);
        // (ë²„íŠ¼ í…ìŠ¤íŠ¸ëŠ” 'Start Translation'ìœ¼ë¡œ ìœ ì§€ë¨)
    });

    // â­ï¸ 6. ì„œë²„ë¡œë¶€í„° ì„¸ì…˜ì´ ì¤‘ì§€ë˜ì—ˆìŒì„ í™•ì¸
    socket.on("session_stopped", data => {
        console.log(`âœ… ì„œë²„ê°€ ì„¸ì…˜ ì¤‘ì§€ í™•ì¸: ${data.message}`);

        // 1. ë²„íŠ¼ í…ìŠ¤íŠ¸ì™€ ìŠ¤íƒ€ì¼ ë³µì› (ë¹„í™œì„± ìƒíƒœ)
        sessionControlBtn.textContent = "Start Translation";
        sessionControlBtn.classList.remove("session-active");

        // â­ï¸ ì„¸ì…˜ ID ì´ˆê¸°í™”
        currentSessionId = "";

        // 2. ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì¶”ê°€
        addSystemMessage(`--- ${data.message} ---`);
    });


    // â­ï¸ [ìˆ˜ì • ì™„ë£Œ] ë¡œê·¸ ë Œë”ë§ í•¨ìˆ˜ (ë™ì  í°íŠ¸ í¬ê¸° ì ìš©)
    function renderLogs(container, dataLogs, scrollToBottom=false){
        container.innerHTML = "";
        dataLogs.forEach(data => {
            const entry = document.createElement("div");
            entry.classList.add("log-entry");

            const timeDiv = document.createElement("div");
            timeDiv.classList.add("timestamp");
            timeDiv.textContent = data.time || "";

            const originalDiv = document.createElement("div");
            originalDiv.classList.add("original");
            originalDiv.textContent = data.original;

            const translatedDiv = document.createElement("div");
            translatedDiv.classList.add("translated");
            translatedDiv.textContent = data.translated; // ğŸ›‘ data.trans -> data.translatedë¡œ ìˆ˜ì •

            // â­ï¸ [ë³µêµ¬] ìƒì„±ëœ ìš”ì†Œë¥¼ entryì— ì¶”ê°€í•˜ê³  entryë¥¼ containerì— ì¶”ê°€
            entry.appendChild(timeDiv);
            entry.appendChild(originalDiv);
            entry.appendChild(translatedDiv);
            container.appendChild(entry);

            // ë¹„ë™ê¸°ì ìœ¼ë¡œ show í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•˜ì—¬ í˜ì´ë“œì¸ íš¨ê³¼ êµ¬í˜„
            setTimeout(() => entry.classList.add('show'), 10);
        });

        if(scrollToBottom) {
            container.scrollTop = container.scrollHeight;
        }
    }
</script>
</body>
</html>